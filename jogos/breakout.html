<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Breakout Neon Remastered</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #05050a;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      touch-action: none; /* Previne zoom no celular */
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #000;
      box-shadow: 0 0 50px rgba(0, 243, 255, 0.1);
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      pointer-events: none;
      width: 100%;
    }
    .score { font-size: 24px; font-weight: bold; text-shadow: 0 0 10px #00f3ff; }
    .lives { font-size: 18px; color: #ff00ff; margin-top: 5px; }
    
    #startScreen, #gameOverScreen {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    h1 { font-size: 48px; color: #00f3ff; text-transform: uppercase; margin-bottom: 10px; text-shadow: 0 0 20px #00f3ff; }
    button {
      background: transparent;
      color: #fff;
      border: 2px solid #ff00ff;
      padding: 15px 40px;
      font-size: 20px;
      cursor: pointer;
      text-transform: uppercase;
      transition: 0.2s;
      box-shadow: 0 0 15px #ff00ff;
      border-radius: 5px;
    }
    button:hover { background: #ff00ff; color: #000; }
    
    /* Controles móveis */
    #mobileControls {
      display: none;
      position: absolute;
      bottom: 0; left: 0; width: 100%; height: 50%;
      z-index: 5;
    }
  </style>
</head>
<body>

  <div id="ui">
    <div class="score">SCORE: <span id="scoreVal">0</span></div>
    <div class="lives">VIDAS: <span id="livesVal">3</span></div>
  </div>

  <div id="startScreen">
    <h1>Breakout Neon</h1>
    <p style="margin-bottom:30px; opacity:0.8">Mouse/Toque para mover. Destrua tudo.</p>
    <button id="btnStart">Iniciar Missão</button>
  </div>

  <div id="gameOverScreen" style="display:none">
    <h1 id="goTitle">GAME OVER</h1>
    <p id="finalScore" style="margin-bottom:20px; font-size:24px;">Score: 0</p>
    <button id="btnRestart">Tentar Novamente</button>
  </div>

  <div id="mobileControls"></div>
  <canvas id="gameCanvas"></canvas>

<script>
/**
 * BREAKOUT NEON REMASTERED
 * Engine física personalizada, partículas e power-ups.
 */

(function() { // IIFE para isolar o escopo e evitar conflitos globais

  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  // Ajuste de Tela
  let W, H;
  let paddle; // Declarado aqui (let) para evitar TDZ error no resize

  function resize() {
    W = canvas.width = Math.min(window.innerWidth, 800);
    H = canvas.height = window.innerHeight;
    // Reposicionar paddle se necessário e se já estiver inicializado
    if(paddle) paddle.y = H - 40;
  }
  window.addEventListener('resize', resize);
  resize();

  // Detectar Mobile
  const isMobile = ('ontouchstart' in window);
  if(isMobile) document.getElementById('mobileControls').style.display = 'block';

  // Estado do Jogo
  let gameState = 'MENU'; // MENU, PLAYING, GAMEOVER
  let score = 0;
  let lives = 3;
  let level = 1;
  let animationId;

  // Audio Context (Procedural igual ao Pacman)
  const Audio = (function(){
    let ctx; 
    function init(){ 
      if(!ctx) ctx = new (window.AudioContext||window.webkitAudioContext)(); 
    }
    function beep(freq, type='square', vol=0.1, dur=0.1){
      if(!ctx) return;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = type;
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(vol, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime+dur);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start();
      osc.stop(ctx.currentTime+dur);
    }
    return { init, beep };
  })();

  // Objetos do Jogo
  // Agora inicializamos o paddle (já declarado lá em cima)
  paddle = {
    x: W/2 - 50, y: H - 40, w: 100, h: 15, color: '#00f3ff', dx: 0, speed: 8
  };

  const ball = {
    x: W/2, y: H/2, r: 8, dx: 4, dy: -4, speed: 6, color: '#fff', active: false
  };

  const bricks = [];
  const particles = [];
  const BRICK_ROWS = 6;
  const BRICK_COLS = 7;
  const COLORS = ['#ff0055', '#ff00aa', '#ff00ff', '#aa00ff', '#5500ff', '#0055ff'];

  // Input
  let rightPressed = false;
  let leftPressed = false;

  document.addEventListener('keydown', (e) => {
    if(e.key === 'Right' || e.key === 'ArrowRight' || e.key === 'd') rightPressed = true;
    if(e.key === 'Left' || e.key === 'ArrowLeft' || e.key === 'a') leftPressed = true;
  });
  document.addEventListener('keyup', (e) => {
    if(e.key === 'Right' || e.key === 'ArrowRight' || e.key === 'd') rightPressed = false;
    if(e.key === 'Left' || e.key === 'ArrowLeft' || e.key === 'a') leftPressed = false;
  });

  // Mouse/Touch
  document.addEventListener('mousemove', (e) => {
    if(gameState !== 'PLAYING') return;
    const relativeX = e.clientX - (window.innerWidth - W)/2;
    if(relativeX > 0 && relativeX < W) {
      paddle.x = relativeX - paddle.w/2;
    }
  });

  document.addEventListener('touchmove', (e) => {
    if(gameState !== 'PLAYING') return;
    e.preventDefault();
    const relativeX = e.touches[0].clientX - (window.innerWidth - W)/2;
    if(relativeX > 0 && relativeX < W) {
      paddle.x = relativeX - paddle.w/2;
    }
  }, {passive: false});


  // Funções do Jogo
  function initBricks() {
    bricks.length = 0;
    const padding = 10;
    const offsetTop = 60;
    const offsetLeft = 35;
    const brickW = (W - (offsetLeft*2) - (padding*(BRICK_COLS-1))) / BRICK_COLS;
    const brickH = 20;

    for(let c=0; c<BRICK_COLS; c++) {
      for(let r=0; r<BRICK_ROWS; r++) {
        bricks.push({
          x: (c*(brickW+padding)) + offsetLeft,
          y: (r*(brickH+padding)) + offsetTop,
          w: brickW, h: brickH,
          status: 1,
          color: COLORS[r % COLORS.length]
        });
      }
    }
  }

  function resetBall() {
    ball.x = paddle.x + paddle.w/2;
    ball.y = paddle.y - 20;
    ball.dx = 4 * (Math.random() > 0.5 ? 1 : -1);
    ball.dy = -4;
    ball.active = false; // Espera clique para lançar
  }

  function createExplosion(x, y, color) {
    for(let i=0; i<15; i++) {
      particles.push({
        x: x, y: y,
        dx: (Math.random() - 0.5) * 8,
        dy: (Math.random() - 0.5) * 8,
        life: 1.0,
        color: color
      });
    }
  }

  function update() {
    if(gameState !== 'PLAYING') return;

    // Paddle Movimento (Teclado)
    if(rightPressed && paddle.x < W - paddle.w) paddle.x += paddle.speed;
    else if(leftPressed && paddle.x > 0) paddle.x -= paddle.speed;

    // Lançar bola automaticamente se inativa
    if(!ball.active) {
      ball.x = paddle.x + paddle.w/2;
      ball.y = paddle.y - 15;
      // Clique lança (simulado aqui pelo start)
      if(rightPressed || leftPressed || isMobile) ball.active = true; 
    } else {
      // Física da Bola
      ball.x += ball.dx;
      ball.y += ball.dy;

      // Paredes
      if(ball.x + ball.r > W || ball.x - ball.r < 0) {
        ball.dx = -ball.dx;
        Audio.beep(150, 'square', 0.05);
      }
      if(ball.y - ball.r < 0) {
        ball.dy = -ball.dy;
        Audio.beep(150, 'square', 0.05);
      }
      else if(ball.y + ball.r > H) {
        // Morte
        lives--;
        document.getElementById('livesVal').innerText = lives;
        Audio.beep(100, 'sawtooth', 0.2, 0.3);
        createExplosion(ball.x, ball.y, '#fff');
        
        if(lives <= 0) {
          gameOver();
        } else {
          resetBall();
        }
      }

      // Colisão Paddle
      if(ball.y + ball.r > paddle.y && 
        ball.x > paddle.x && 
        ball.x < paddle.x + paddle.w) {
          
        // Rebate dependendo de onde bateu no paddle
        let collidePoint = ball.x - (paddle.x + paddle.w/2);
        collidePoint = collidePoint / (paddle.w/2);
        let angle = collidePoint * (Math.PI/3); // Max 60 graus

        let speed = Math.sqrt(ball.dx*ball.dx + ball.dy*ball.dy);
        // Aumenta velocidade levemente
        speed = Math.min(speed + 0.2, 12);

        ball.dx = speed * Math.sin(angle);
        ball.dy = -speed * Math.cos(angle);
        
        Audio.beep(300, 'sine', 0.1);
        // Efeito visual no paddle
        paddle.color = '#fff';
        setTimeout(()=> paddle.color='#00f3ff', 50);
      }

      // Colisão Tijolos
      let activeBricks = 0;
      for(let b of bricks) {
        if(b.status === 1) {
          activeBricks++;
          if(ball.x > b.x && ball.x < b.x+b.w && ball.y > b.y && ball.y < b.y+b.h) {
            ball.dy = -ball.dy;
            b.status = 0;
            score += 10 * level;
            document.getElementById('scoreVal').innerText = score;
            createExplosion(b.x + b.w/2, b.y + b.h/2, b.color);
            Audio.beep(500 + (Math.random()*200), 'square', 0.08);
          }
        }
      }

      if(activeBricks === 0) {
        // Nível concluído
        level++;
        Audio.beep(800, 'sine', 0.2, 0.5);
        initBricks();
        resetBall();
        ball.speed += 1;
      }
    }

    // Partículas
    for(let i = particles.length-1; i>=0; i--) {
      let p = particles[i];
      p.x += p.dx;
      p.y += p.dy;
      p.life -= 0.02;
      if(p.life <= 0) particles.splice(i, 1);
    }
  }

  function draw() {
    // Rastro (Trail)
    ctx.fillStyle = 'rgba(5, 5, 10, 0.3)';
    ctx.fillRect(0, 0, W, H);

    // Tijolos
    for(let b of bricks) {
      if(b.status === 1) {
        ctx.fillStyle = b.color;
        ctx.shadowBlur = 10;
        ctx.shadowColor = b.color;
        ctx.fillRect(b.x, b.y, b.w, b.h);
        ctx.shadowBlur = 0;
      }
    }

    // Paddle
    ctx.fillStyle = paddle.color;
    ctx.shadowBlur = 15;
    ctx.shadowColor = paddle.color;
    ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);
    ctx.shadowBlur = 0;

    // Bola
    if(ball.active || gameState === 'PLAYING') {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
      ctx.fillStyle = '#fff';
      ctx.fill();
      ctx.shadowBlur = 10;
      ctx.shadowColor = '#fff';
      ctx.closePath();
      ctx.shadowBlur = 0;
    }

    // Partículas
    for(let p of particles) {
      ctx.globalAlpha = p.life;
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x, p.y, 3, 3);
      ctx.globalAlpha = 1.0;
    }

    requestAnimationFrame(draw);
  }

  // Game Loop
  setInterval(update, 1000/60);
  draw(); // Render separado para fps suaves

  function startGame() {
    Audio.init();
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('gameOverScreen').style.display = 'none';
    score = 0;
    lives = 3;
    level = 1;
    document.getElementById('scoreVal').innerText = score;
    document.getElementById('livesVal').innerText = lives;
    
    initBricks();
    resetBall();
    gameState = 'PLAYING';
    // Lança bola no primeiro clique/toque pós start
    ball.active = true;
  }

  function gameOver() {
    gameState = 'GAMEOVER';
    document.getElementById('gameOverScreen').style.display = 'flex';
    document.getElementById('finalScore').innerText = 'Score Final: ' + score;
    document.getElementById('goTitle').innerText = score > 1000 ? "EXCELENTE!" : "GAME OVER";
  }

  document.getElementById('btnStart').onclick = startGame;
  document.getElementById('btnRestart').onclick = startGame;

})(); // Fim da IIFE
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Torneio Ultimate - Vers√£o Final Responsiva</title>
    
    <!-- Fontes: Inter (UI) e Rajdhani (Esportes/N√∫meros) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Paleta Dark Premium */
            --bg-deep: #050505;
            --bg-gradient: radial-gradient(circle at 50% 0%, #1a1d29 0%, #050505 100%);
            
            /* Cart√µes com Efeito de Vidro */
            --card-bg: rgba(30, 41, 59, 0.7);
            --card-border: rgba(255, 255, 255, 0.1);
            --card-backdrop: blur(10px);
            
            /* Cores */
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --accent-blue: #3b82f6;
            --winner-gold: #fbbf24;
            --danger: #ef4444;
            --line-color: rgba(255, 255, 255, 0.15);

            /* Altura do Header */
            --header-height: 60px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Inter', sans-serif;
        }

        html, body {
            height: 100%;
            background-color: var(--bg-deep);
            color: var(--text-main);
        }

        body {
            display: flex;
            flex-direction: column;
            /* Permite rolagem vertical normal na p√°gina */
            overflow-y: auto; 
            overflow-x: hidden;
            background-image: var(--bg-gradient);
            background-attachment: fixed; /* Fundo fixo ao rolar */
        }

        /* --- Header Fixo --- */
        header {
            height: var(--header-height);
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--card-border);
            background: rgba(5, 5, 5, 0.95);
            position: sticky; /* Fixa o header no topo */
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }

        .logo {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-icon {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--card-border);
            color: var(--text-muted);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* --- √Årea Principal (Bracket Wrapper) --- */
        .bracket-wrapper {
            flex: 1;
            /* Permite scroll horizontal */
            overflow-x: auto; 
            /* Importante: permite que o conte√∫do cres√ßa verticalmente */
            height: auto; 
            padding: 20px;
            
            /* Configura√ß√£o Flex para alinhar as colunas */
            display: flex;
            align-items: flex-start; /* Alinha tudo no topo inicialmente */
            
            /* Melhoria de scroll no mobile */
            -webkit-overflow-scrolling: touch;
        }

        /* Container interno que segura as colunas */
        .bracket-container {
            display: flex;
            flex-direction: row;
            /* Garante altura m√≠nima para caber 8 jogos com folga */
            min-height: 900px; 
            padding-right: 40px;
        }

        /* --- Colunas (Rodadas) --- */
        .round {
            display: flex;
            flex-direction: column;
            /* Distribui os jogos verticalmente de forma igual */
            justify-content: space-around; 
            
            width: 85vw; /* Largura no mobile */
            max-width: 300px; /* Largura m√°xima no Desktop */
            margin-right: 30px;
            position: relative;
            
            /* A altura da coluna ser√° 100% do container pai, que cresce conforme o conte√∫do */
            align-self: stretch; 
        }

        .round:last-child {
            margin-right: 0;
            width: 90vw;
            max-width: 350px;
        }

        /* T√≠tulo da Rodada (Sticky dentro da coluna) */
        .round-header {
            position: sticky;
            top: calc(var(--header-height) + 10px); /* Fica abaixo do header principal */
            text-align: center;
            margin-bottom: 20px;
            z-index: 10;
            height: 0; /* Truque para n√£o ocupar espa√ßo no fluxo flex justify-around */
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .badge {
            background: rgba(15, 23, 42, 0.95); /* Fundo escuro para ler em cima das linhas */
            color: var(--accent-blue);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 2px;
            padding: 6px 16px;
            border-radius: 20px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* --- Cart√£o do Jogo --- */
        .matchup {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            padding: 10px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 10px 0; /* Espa√ßamento m√≠nimo vertical */
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        /* --- Linhas e Times --- */
        .team-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 8px;
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            border: 1px solid transparent;
            min-height: 40px;
        }

        .team-name {
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
            color: var(--text-muted);
        }

        .score-input {
            width: 30px;
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            text-align: center;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            margin-left: 8px;
            border-radius: 0;
            padding: 0;
        }

        .score-input:focus { outline: none; border-color: var(--accent-blue); }
        .score-input:disabled { border-bottom: none; }

        /* Estados de Vit√≥ria/Derrota */
        .team-row.winner {
            background: rgba(251, 191, 36, 0.1);
            border-color: rgba(251, 191, 36, 0.4);
        }
        .team-row.winner .team-name { color: var(--winner-gold); font-weight: 700; }
        .team-row.winner .score-input { color: var(--winner-gold); }
        
        .team-row.loser { opacity: 0.5; }
        .team-row.loser .team-name { text-decoration: line-through; }

        /* --- P√™naltis --- */
        .penalties-wrapper {
            display: none;
            margin-top: 5px;
            border-top: 1px dashed rgba(255,255,255,0.1);
            padding-top: 5px;
        }
        .penalties-wrapper.show { display: block; }
        
        .penalties-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
        }
        
        .pen-inputs { display: flex; gap: 5px; align-items: center; }
        .pen-input {
            width: 24px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: #fca5a5;
            text-align: center;
            border-radius: 4px;
        }

        /* --- Conectores (Linhas) --- */
        /* Mobile: Setinha simples para evitar quebra de layout na rolagem */
        .matchup::after {
            content: '';
            position: absolute;
            right: -15px;
            top: 50%;
            width: 15px;
            height: 2px;
            background: var(--line-color);
        }

        /* Desktop: Linhas completas */
        @media (min-width: 768px) {
            .matchup::after { display: none; } /* Remove seta mobile */
            
            .connector-desktop {
                position: absolute;
                right: -30px; /* Metade da margem da coluna */
                width: 30px;
                border-color: var(--line-color);
                border-style: solid;
                border-width: 0;
                pointer-events: none;
            }

            /* Logica para conectar pares */
            .round-1 .matchup:nth-child(odd) .connector-desktop {
                top: 50%; height: 100%; border-right-width: 2px; border-top-width: 2px;
            }
            .round-1 .matchup:nth-child(even) .connector-desktop {
                top: -50%; height: 100%; border-right-width: 2px; border-bottom-width: 2px;
            }

            .round-2 .matchup:nth-child(odd) .connector-desktop {
                top: 50%; height: 200%; border-right-width: 2px; border-top-width: 2px;
            }
            .round-2 .matchup:nth-child(even) .connector-desktop {
                top: -150%; height: 200%; border-right-width: 2px; border-bottom-width: 2px;
            }
        }

        /* --- Campe√£o --- */
        .champion-box {
            text-align: center;
            padding: 20px;
        }
        .trophy { font-size: 4rem; margin-bottom: 10px; display: inline-block; }
        .champion-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--winner-gold);
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.5s ease;
        }
        .champion-name.visible { opacity: 1; transform: translateY(0); }

        /* Confete */
        #confetti {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 200;
        }

    </style>
</head>
<body>

    <header>
        <div class="logo">Ultimate<span style="color:var(--winner-gold)">Cup</span></div>
        <div class="btn-icon" onclick="resetData()" title="Resetar">üóëÔ∏è</div>
    </header>

    <canvas id="confetti"></canvas>

    <!-- Wrapper com scroll horizontal -->
    <div class="bracket-wrapper">
        <!-- Container interno que cresce verticalmente -->
        <div class="bracket-container">
            
            <!-- Oitavas (8 Jogos) -->
            <div class="round round-1" id="r16">
                <div class="round-header"><span class="badge">Oitavas</span></div>
                <!-- JS Preenche -->
            </div>

            <!-- Quartas (4 Jogos) -->
            <div class="round round-2" id="qf">
                <div class="round-header"><span class="badge">Quartas</span></div>
            </div>

            <!-- Semis (2 Jogos) -->
            <div class="round round-3" id="sf">
                <div class="round-header"><span class="badge">Semis</span></div>
            </div>

            <!-- Final (1 Jogo) -->
            <div class="round round-4" id="final">
                <div class="round-header"><span class="badge" style="border-color:var(--winner-gold); color:var(--winner-gold)">Final</span></div>
            </div>

            <!-- Campe√£o -->
            <div class="round round-5">
                <div class="champion-box">
                    <div class="trophy">üèÜ</div>
                    <div class="champion-name" id="winner-display">?</div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const STORAGE_KEY = 'ultimate_bracket_fixed_v2';
        
        const initialTeams = [
            { id: 1, p1: "Barcelona '09", p2: "Juventus '03" },
            { id: 2, p1: "Real Madrid '03", p2: "Chelsea '06" },
            { id: 3, p1: "Milan '05", p2: "Arsenal '04" },
            { id: 4, p1: "Man Utd '08", p2: "Bayern '01" },
            { id: 5, p1: "Inter '10", p2: "Ajax '02" },
            { id: 6, p1: "Liverpool '09", p2: "Porto '04" },
            { id: 7, p1: "Valencia '04", p2: "Lyon '06" },
            { id: 8, p1: "Barcelona '06", p2: "Milan '07" }
        ];

        function init() {
            renderStructure();
            loadData();
        }

        function renderStructure() {
            // Renderiza 8 slots nas oitavas
            renderRound('r16', 8, initialTeams);
            // Renderiza 4 slots nas quartas
            renderRound('qf', 4);
            // Renderiza 2 slots nas semis
            renderRound('sf', 2);
            // Renderiza 1 slot na final
            renderRound('final', 1);
        }

        function renderRound(roundId, count, data = []) {
            const container = document.getElementById(roundId);
            // Salva o header para reinserir
            const header = container.querySelector('.round-header');
            container.innerHTML = '';
            container.appendChild(header);

            for(let i=1; i<=count; i++) {
                const matchData = data[i-1] || { p1: '', p2: '' };
                const matchId = matchData.id || i;
                
                const div = document.createElement('div');
                div.className = 'matchup';
                div.id = `card-${roundId}-${matchId}`;
                
                div.innerHTML = `
                    <div class="connector-desktop"></div>
                    
                    <div class="team-row" id="row-${roundId}-${matchId}-1">
                        <span class="team-name" id="name-${roundId}-${matchId}-1">${matchData.p1}</span>
                        <input type="number" inputmode="numeric" class="score-input" 
                               id="score-${roundId}-${matchId}-1"
                               oninput="processInput('${roundId}', ${matchId})"
                               ${matchData.p1 ? '' : 'disabled'}>
                    </div>
                    
                    <div class="team-row" id="row-${roundId}-${matchId}-2">
                        <span class="team-name" id="name-${roundId}-${matchId}-2">${matchData.p2}</span>
                        <input type="number" inputmode="numeric" class="score-input" 
                               id="score-${roundId}-${matchId}-2"
                               oninput="processInput('${roundId}', ${matchId})"
                               ${matchData.p2 ? '' : 'disabled'}>
                    </div>

                    <div class="penalties-wrapper" id="pen-wrap-${roundId}-${matchId}">
                        <div class="penalties-container">
                            <span style="color:#ef4444; font-weight:bold; letter-spacing:1px">P√äNALTIS</span>
                            <div class="pen-inputs">
                                <input type="number" inputmode="numeric" class="pen-input" id="pen-${roundId}-${matchId}-1" oninput="processInput('${roundId}', ${matchId})">
                                <span>x</span>
                                <input type="number" inputmode="numeric" class="pen-input" id="pen-${roundId}-${matchId}-2" oninput="processInput('${roundId}', ${matchId})">
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            }
        }

        window.processInput = function(round, matchId) {
            updateMatchLogic(round, matchId);
            saveData();
        };

        function updateMatchLogic(round, matchId) {
            const s1 = document.getElementById(`score-${round}-${matchId}-1`).value;
            const s2 = document.getElementById(`score-${round}-${matchId}-2`).value;
            const name1 = document.getElementById(`name-${round}-${matchId}-1`).innerText;
            const name2 = document.getElementById(`name-${round}-${matchId}-2`).innerText;
            const row1 = document.getElementById(`row-${round}-${matchId}-1`);
            const row2 = document.getElementById(`row-${round}-${matchId}-2`);
            const penWrap = document.getElementById(`pen-wrap-${round}-${matchId}`);

            // Reset
            row1.classList.remove('winner', 'loser');
            row2.classList.remove('winner', 'loser');

            if(s1 === '' || s2 === '' || !name1 || !name2) {
                penWrap.classList.remove('show');
                return;
            }

            const score1 = parseInt(s1);
            const score2 = parseInt(s2);
            let winner = null;

            // L√≥gica Empate
            if(score1 === score2) {
                penWrap.classList.add('show');
                const p1 = document.getElementById(`pen-${round}-${matchId}-1`).value;
                const p2 = document.getElementById(`pen-${round}-${matchId}-2`).value;
                
                if(p1 !== '' && p2 !== '') {
                    if(parseInt(p1) > parseInt(p2)) winner = 1;
                    else if(parseInt(p2) > parseInt(p1)) winner = 2;
                }
            } else {
                penWrap.classList.remove('show');
                // Limpa pens
                document.getElementById(`pen-${round}-${matchId}-1`).value = '';
                document.getElementById(`pen-${round}-${matchId}-2`).value = '';
                winner = score1 > score2 ? 1 : 2;
            }

            if(winner) {
                if(winner === 1) {
                    row1.classList.add('winner');
                    row2.classList.add('loser');
                    advance(round, matchId, 1, name1);
                } else {
                    row2.classList.add('winner');
                    row1.classList.add('loser');
                    advance(round, matchId, 2, name2);
                }
            }
        }

        function advance(round, matchId, slot, name) {
            let nextR, nextM, nextS;

            if(round === 'r16') { nextR='qf'; nextM=Math.ceil(matchId/2); nextS=(matchId%2!==0)?1:2; }
            else if(round === 'qf') { nextR='sf'; nextM=Math.ceil(matchId/2); nextS=(matchId%2!==0)?1:2; }
            else if(round === 'sf') { nextR='final'; nextM=1; nextS=matchId; }
            else if(round === 'final') { declareChampion(name); return; }

            const targetName = document.getElementById(`name-${nextR}-${nextM}-${nextS}`);
            const targetInput = document.getElementById(`score-${nextR}-${nextM}-${nextS}`);

            if(targetName.innerText !== name) {
                targetName.innerText = name;
                targetInput.disabled = false;
                targetInput.value = ''; // Limpa placar anterior da pr√≥xima fase
                
                // Anima scroll suave se n√£o estiver vis√≠vel
                const nextCard = document.getElementById(`card-${nextR}-${nextM}`);
                // N√£o for√ßar scroll o tempo todo no mobile para n√£o atrapalhar, apenas se desejar
            }
        }

        function declareChampion(name) {
            const el = document.getElementById('winner-display');
            if(el.innerText !== name) {
                el.innerText = name;
                el.classList.add('visible');
                startConfetti();
                // Scroll suave at√© o final
                setTimeout(() => {
                    document.querySelector('.round-5').scrollIntoView({behavior:'smooth', inline:'center'});
                }, 500);
            }
        }

        // --- Persist√™ncia Local ---
        function saveData() {
            const state = {};
            // Salva inputs
            document.querySelectorAll('input').forEach(inp => state[inp.id] = inp.value);
            // Salva nomes din√¢micos (exceto round 1 que √© fixo)
            document.querySelectorAll('.round:not(.round-1) .team-name').forEach(span => state[span.id] = span.innerText);
            
            state['champion'] = document.getElementById('winner-display').innerText;
            state['championVis'] = document.getElementById('winner-display').classList.contains('visible');
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        function loadData() {
            const raw = localStorage.getItem(STORAGE_KEY);
            if(!raw) return;
            const state = JSON.parse(raw);

            // 1. Restaura Nomes
            Object.keys(state).forEach(k => {
                if(k.startsWith('name-')) {
                    const el = document.getElementById(k);
                    if(el) {
                        el.innerText = state[k];
                        // Habilita input
                        const inpId = k.replace('name-', 'score-');
                        const inp = document.getElementById(inpId);
                        if(inp && state[k]) inp.disabled = false;
                    }
                }
            });

            // 2. Restaura Inputs
            Object.keys(state).forEach(k => {
                if(k.startsWith('score-') || k.startsWith('pen-')) {
                    const el = document.getElementById(k);
                    if(el) el.value = state[k];
                }
            });

            // 3. Restaura Campe√£o
            if(state['champion']) {
                const el = document.getElementById('winner-display');
                el.innerText = state['champion'];
                if(state['championVis']) el.classList.add('visible');
            }

            // 4. Reaplica L√≥gica Visual (Cores)
            // Necess√°rio rodar updateMatchLogic para cada card preenchido
            setTimeout(() => {
                document.querySelectorAll('.matchup').forEach(m => {
                    const parts = m.id.split('-'); // card-r16-1
                    if(parts.length === 3) updateMatchLogic(parts[1], parts[2]);
                });
            }, 100);
        }

        window.resetData = function() {
            if(confirm('Apagar tudo?')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // --- Confetti ---
        let confettiRunning = false;
        function startConfetti() {
            if(confettiRunning) return;
            confettiRunning = true;
            const canvas = document.getElementById('confetti');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const p = Array.from({length: 100}, () => ({
                x: Math.random()*canvas.width, y: -20,
                vx: Math.random()*4-2, vy: Math.random()*4+2,
                c: `hsl(${Math.random()*50+40},100%,50%)`
            }));

            function loop() {
                if(!confettiRunning) return;
                ctx.clearRect(0,0,canvas.width,canvas.height);
                p.forEach(pt => {
                    pt.x+=pt.vx; pt.y+=pt.vy;
                    if(pt.y > canvas.height) pt.y = -20;
                    ctx.fillStyle = pt.c; ctx.fillRect(pt.x,pt.y,6,6);
                });
                requestAnimationFrame(loop);
            }
            loop();
        }

        init();
    </script>
</body>
</html>


